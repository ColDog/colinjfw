<!DOCTYPE html>
<title>GraphQL Api | colinfjw</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="View the original Medium post here/ Graphql is an awesome new technology which is making it easier for client side developers to iterate quickly and batch to...">
<meta name="author" content="Colin Walker">
<meta name="generator" content="Jekyll v3.8.5">
<link rel="canonical" href="http://localhost:4000/graphql-api/">
<link rel="stylesheet" href="/assets/css/index.css">
<link rel="stylesheet" href="/assets/css/classes.css">
<link rel="stylesheet" href="/assets/css/contrast.css">
<link rel="alternate" type="application/atom+xml" href="/feed.xml" title="colinfjw" />




<body class="light">

<header>
  <h1><a href="/">colinfjw</a></h1>
  
  <nav><a class="icon" href="mailto:colinwalker270@gmail.com"><svg><use xlink:href="/assets/fontawesome/icons.svg#envelope"></use></svg></a><a class="icon" href="https://www.twitter.com/colinjfw"><svg><use xlink:href="/assets/fontawesome/icons.svg#twitter"></use></svg></a><a class="icon" href="https://github.com/coldog"><svg><use xlink:href="/assets/fontawesome/icons.svg#github"></use></svg></a><a class="icon" href="/reading"><svg><use xlink:href="/assets/fontawesome/icons.svg#book"></use></svg></a><a class="icon" href="feed.xml"><svg><use xlink:href="/assets/fontawesome/icons.svg#rss"></use></svg></a></nav>
</header>

<article>
  <header><h1><a href="/graphql-api/">GraphQL Api</a></h1>
    <time datetime="2016-10-01T00:00:00-07:00">October 01, 2016</time>
  </header>
<blockquote>
  <p>View the original Medium post <a href="https://hackernoon.com/graphql-api-with-rails-faab252aaffa#.ufxhlt2l9">here</a>/</p>
</blockquote>

<p>Graphql is an awesome new technology which is making it easier for client</p>

<p>side developers to iterate quickly and batch together network requests.</p>

<p>I really like the promise provided by GraphQl however it is not as easy as rest to get up and running on immediately. This blog post takes a look at how to build a working GraphQL backend in just a few steps using rails.</p>

<p>I am using my own project graphql-api as a framework for building out the GraphQL backend.</p>

<p>We will look at building a basic blogging application. A blog will have an author and some tags.</p>

<p>First create the rails backend.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails new blog-api <span class="nt">--api</span>
</code></pre></div></div>

<p>Add the necessary libraries to the Gemfile</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'graphql'</span>
<span class="n">gem</span> <span class="s1">'graphql-api'</span>
</code></pre></div></div>

<p>Create our models</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Author</span> <span class="nb">name</span><span class="ss">:string</span>
<span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Blog</span> <span class="n">title</span><span class="ss">:string</span> <span class="n">content</span><span class="ss">:text</span> <span class="n">author</span><span class="ss">:references</span>
<span class="n">rails</span> <span class="n">db</span><span class="ss">:migrate</span>
</code></pre></div></div>

<p>Add our has many relations to author class</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Author</span>
  <span class="n">has_many</span> <span class="ss">:blogs</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Great! Now we have a basic setup for our blogging backend. Let’s add some controllers to serve basic Graphql queries.</p>

<p>Add the following file to app/controllers/graphql_controller.rb.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GraphqlController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="no">SCHEMA</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Api</span><span class="o">::</span><span class="no">Schema</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">schema</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">render</span> <span class="ss">json: </span><span class="no">SCHEMA</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
      <span class="n">params</span><span class="p">[</span><span class="ss">:query</span><span class="p">],</span>
      <span class="ss">variables: </span><span class="n">params</span><span class="p">[</span><span class="ss">:variables</span><span class="p">]</span> <span class="o">||</span> <span class="p">{},</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Add the following route to config/routes.rb</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resources</span> <span class="ss">:graphql</span><span class="p">,</span> <span class="ss">only: :create</span>
</code></pre></div></div>

<p>Now let’s test out the new api with curl. Start up the server and run the
following command to see if we have any blog posts</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XPOST</span> <span class="nt">-d</span> <span class="s1">'query=query { blogs { id } }'</span> <span class="se">\</span>
     localhost:3000/graphql
<span class="o">{</span><span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"blogs"</span>:[]<span class="o">}}</span>
</code></pre></div></div>

<p>Let’s create an author</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XPOST</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'query=mutation {
         createAuthor(input: {name: "foobar"}) {
            author { id }
     }}'</span> localhost:3000/graphql
<span class="o">{</span><span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"createAuthor"</span>:<span class="o">{</span><span class="s2">"author"</span>:<span class="o">{</span><span class="s2">"id"</span>:1<span class="o">}}}}</span>
</code></pre></div></div>

<p>Now let’s create a blog with that author’s id</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XPOST</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'query=mutation {
         createBlog(input: {title: "foobar", author_id: 1}) {
             blog { id }
      }}'</span> localhost:3000/graphql
<span class="o">{</span><span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"createBlog"</span>:<span class="o">{</span><span class="s2">"blog"</span>:<span class="o">{</span><span class="s2">"id"</span>:1<span class="o">}}}}</span>
</code></pre></div></div>

<p>Let’s try that first query again, but this time let’s try and return the blog authors as well as the blog name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-XPOST</span> <span class="nt">-d</span> <span class="s1">'query=query {
  blogs {
    id
    title
    content
    author {
      name
    }
  }
}'</span> localhost:3000/graphql
</code></pre></div></div>

<p>You can also run updateBlog mutations as well as updateAuthor mutations. Try deleting an author or blog and see what responses you get back.</p>

  
  
</article>


<footer>
  <a class="gray" href="/s3-website/">« How to Run Cost Effective Frontend Applications on S3</a>
  <a class="gray" href="/musefind/">Musefind »</a>
</footer>




</body>
